# keycloak en https
mkdir certs
openssl req -x509 -newkey rsa:2048 -keyout certs/key.pem -out certs/cert.pem -days 365 -nodes -subj "/CN=localhost"

cd certs/
docker run -p 8443:8443 \
-e KEYCLOAK_ADMIN=admin \
-e KEYCLOAK_ADMIN_PASSWORD=admin \
-v "$(pwd)/cert.pem:/opt/keycloak/cert.pem:ro" \
-v "$(pwd)/key.pem:/opt/keycloak/key.pem:ro" \
quay.io/keycloak/keycloak:23.0.6 start-dev \
--https-certificate-file=/opt/keycloak/cert.pem \
--https-certificate-key-file=/opt/keycloak/key.pem \
--https-port=8443


# ngrok
https://dashboard.ngrok.com/domains
ngrok http https://localhost:8443 --url=keycloak.adjoda.com.ngrok.app




# 
lefort@GT13Pro:/mnt/d/dev/git/dev-blog/kubernetes/spring-boot-helm/deploy-keycloak/certs$ docker run -p 8443:8443 \
-e KEYCLOAK_ADMIN=admin \
-e KEYCLOAK_ADMIN_PASSWORD=admin \
-v "$(pwd)/cert.pem:/opt/keycloak/cert.pem:ro" \
-v "$(pwd)/key.pem:/opt/keycloak/key.pem:ro" \
quay.io/keycloak/keycloak:23.0.6 start-dev \
--https-certificate-file=/opt/keycloak/cert.pem \
--https-certificate-key-file=/opt/keycloak/key.pem \
--https-port=8443
Updating the configuration and installing your custom providers, if any. Please wait.
2025-08-05 21:46:37,314 INFO  [io.quarkus.deployment.QuarkusAugmentor] (main) Quarkus augmentation completed in 11614ms





# l'installation de keycloak dans kubernetes ne marche pas avec l'ingress. car le token-service contient l'ingress et non le DNS de keycloak dans le cluster
  ==> solution utiliser plus tard une external IP donc LoadBalancer

 curl http://my-keycloak-release.default.svc.cluster.local/realms/adjoda-dev-
realm
{"realm":"adjoda-dev-realm","public_key":"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAn9j7r4DHRO8Qwqfgey0b4eiDSBk6WkRP0zASHz36yyqb82anUpB32hPxyXGP0kIuEdH7HzjFZb0I9uR73/suyzje1qDAvZiEXElQb8mwMqUkz56ZypCDmfW6C5hag8StiryBIwwvINEQdpRRmPHp+oPs147kTweKAlTGg0dAp+Dbbl9nCYlyMf3klyqlX+jIIe9KUAbUfMMGVh/wokiqAbeiBHg/oX6LdIiBqSo1XI29Sg6UpmMJFe4DAvCMJFYzP82iUuxWmwO2STHlIq3KhEntoT9rC3q1HiPm6AsU77HuyFjEk2kLZMUdAFVrPVi9NR5hFcDluBxn/ZgQZpGxPwIDAQAB",
 "token-service":"http://keycloak.localhost/realms/adjoda-dev-realm/protocol/openid-connect","account-service":"http://keycloak.localhost/realms/adjoda-dev-realm/account","tokens-not-before":0}/



helm my-keycloak-release oci://registry-1.docker.io/bitnamicharts/keycloak -f values.yaml



helm uninstall my-keycloak-release
kubectl delete pvc -l app.kubernetes.io/instance=my-keycloak-release,app.kubernetes.io/name=postgresql
helm install my-keycloak-release oci://registry-1.docker.io/bitnamicharts/keycloak -f values.yaml


#

lefort@GT13Pro:/mnt/d/dev/git/dev-blog/ecommerce-project/local-deploy/keycloak$ helm install my-keycloak-release oci://registry-1.docker.io/bitnamicharts/keycloak -f values.yaml
Pulled: registry-1.docker.io/bitnamicharts/keycloak:25.2.0
Digest: sha256:3e12451e0300902bafa1e588e62cce8ad3467dc3d6bf15352c25a0393a75fc6e
coalesce.go:301: warning: destination for postgresql.tls.autoGenerated is a table. Ignoring non-table value (false)
NAME: my-keycloak-release
LAST DEPLOYED: Sat Aug 30 23:16:23 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
CHART NAME: keycloak
CHART VERSION: 25.2.0
APP VERSION: 26.3.3

âš  WARNING: Since August 28th, 2025, only a limited subset of images/charts are available for free.
Subscribe to Bitnami Secure Images to receive continued support and security updates.
More info at https://bitnami.com and https://github.com/bitnami/containers/issues/83267

** Please be patient while the chart is being deployed **

Keycloak can be accessed through the following DNS name from within your cluster:

    my-keycloak-release.default.svc.cluster.local (port 80)

To access Keycloak from outside the cluster execute the following commands:

1. Get the Keycloak URL and associate its hostname to your cluster external IP:

   export CLUSTER_IP=$(minikube ip) # On Minikube. Use: `kubectl cluster-info` on others K8s clusters
   echo "Keycloak URL: http://keycloak.localhost/"
   echo "$CLUSTER_IP  keycloak.localhost" | sudo tee -a /etc/hosts

2. Access Keycloak using the obtained URL.
3. Access the Administration Console using the following credentials:

echo Username: admin
echo Password: $(kubectl get secret --namespace default my-keycloak-release -o jsonpath="{.data.admin-password}" | base64 -d)

WARNING: There are "resources" sections in the chart not set. Using "resourcesPreset" is not recommended for production. For production installations, please set the following values according to your workload needs:
- resources
  +info https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
